<!DOCTYPE html>
<html class="no-js" lang="zh-CN">
<head>
	<meta charset="UTF-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="theme-color" content="#1b1b1b">
	<title>Dbs | 张海余的主页</title>
	<script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script>
	<meta name="description" content="">
		<meta property="og:title" content="Dbs" />
<meta property="og:description" content="张海余的个人博客" />
<meta property="og:type" content="website" />
<meta property="og:url" content="https://fishwin.github.io/db/" />


		<meta itemprop="name" content="Dbs">
<meta itemprop="description" content="张海余的个人博客">
		<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Dbs"/>
<meta name="twitter:description" content="张海余的个人博客"/>

	<link rel="stylesheet" href="/css/bundle.css">
	<link rel="stylesheet" href="/css/custom.css">
	<link rel="stylesheet" href="/css/themes/dark-green.css">
	<link rel="icon" href="/icons/16.png" sizes="16x16" type="image/png">
	<link rel="icon" href="/icons/32.png" sizes="32x32" type="image/png">
	<link rel="alternate" type="application/rss+xml" href="/db/index.xml" title="张海余的主页">
	<link rel="manifest" href="/manifest.json">
		
</head>
<body class="body kind-section">
	<header class="header">
	<a class="logo" href="/">张海余的主页</a>
	
<nav class="main-nav main-nav--right" role="navigation">
	<button id="toggle" class="main-nav__btn" aria-label="Menu toggle" aria-expanded="false" tabindex="0">
		<div class="main-nav__btn-box" tabindex="-1">
			<svg class="main-nav__icon icon-menu" width="18" height="18" viewBox="0 0 18 18">
				<path class="icon-menu__burger" d="M18 0v3.6H0V0h18zM0 10.8h18V7.2H0v3.6zM0 18h18v-3.6H0V18z"/>
				<path class="icon-menu__x" d="M11.55 9L18 15.45 15.45 18 9 11.55 2.55 18 0 15.45 6.45 9 0 2.55 2.55 0 9 6.45 15.45 0 18 2.55 11.55 9z"/>
			</svg>
		</div>
	</button>
	<ul id="menu" class="main-nav__list">
			<li class="main-nav__item">
				<a class="main-nav__link" href="/">
					
					<span class="main-nav__text">首页</span>
					
				</a>
			</li>
			<li class="main-nav__item">
				<a class="main-nav__link" href="/golang/">
					
					<span class="main-nav__text">Go</span>
					
				</a>
			</li>
			<li class="main-nav__item">
				<a class="main-nav__link" href="/os/">
					
					<span class="main-nav__text">操作系统</span>
					
				</a>
			</li>
			<li class="main-nav__item">
				<a class="main-nav__link" href="/net/">
					
					<span class="main-nav__text">网络协议</span>
					
				</a>
			</li>
			<li class="main-nav__item">
				<a class="main-nav__link" href="/distributiton/">
					
					<span class="main-nav__text">分布式</span>
					
				</a>
			</li>
			<li class="main-nav__item">
				<a class="main-nav__link" href="/sysdesign/">
					
					<span class="main-nav__text">系统设计</span>
					
				</a>
			</li>
			<li class="main-nav__item">
				<a class="main-nav__link" href="/algorithm/">
					
					<span class="main-nav__text">算法</span>
					
				</a>
			</li>
			<li class="main-nav__item">
				<a class="main-nav__link" href="/db/">
					
					<span class="main-nav__text">数据库</span>
					
				</a>
			</li>
			<li class="main-nav__item">
				<a class="main-nav__link" href="/middleware/">
					
					<span class="main-nav__text">中间件</span>
					
				</a>
			</li>
			<li class="main-nav__item">
				<a class="main-nav__link" href="/othertech/">
					
					<span class="main-nav__text">谈古论今</span>
					
				</a>
			</li>
			<li class="main-nav__item">
				<a class="main-nav__link" href="/about/">
					
					<span class="main-nav__text">关于</span>
					
				</a>
			</li>
	</ul>
</nav>
</header>
	<div class="primary">
	
	<main class="main">
		
<nav class="breadcrumb block" aria-label="breadcrumb">
	<ol class="breadcrumb__list">
		
		<li class="breadcrumb__item">
			<a class="breadcrumbs__link" href="/">Home</a>
		</li>
		<li class="breadcrumbs__item breadcrumb__item--active" aria-current="page">Dbs</li>
	</ol>
</nav>
		<div class="page block">
			<h1 class="page__title">Dbs</h1>
			
		</div>
		<div class="cards">
			
				<div class="card card--1col">
					<article class="entry card__box block">
	<h1 class="entry__title title-excerpt"><a class="entry__title-link" href="/db/redis%E6%8C%81%E4%B9%85%E5%8C%96/">Redis持久化</a></h1>
	<div class="entry__content">redis为什么需要持久化？ redis中的数据全部保存在内存中，如果redis实例突然宕机，数据会全部丢失。
我们并不总是只拿redis做缓存，所以持久化是必要的。在redis宕机之后，我们依然可以恢复其中的数据。
redis主要提供了两种持久化的方式RDB(Redis Database)和AOF(Append only File)。
RDB 概念  Redis默认采用的是RDB持久化方式。
按照一定的周期，将redis内存中的数据以二进制的格式（内存快照）保存到磁盘文件中。
RDB持久化过程分为手动触发和自动触发。
Redis默认会采用LZF算法对生成的RDB文件做压缩处理，压缩后的文件远远小于内存大小。
 配置 满足任一条件都会触发rdb持久化
# Unless specified otherwise, by default Redis will save the DB: # * After 3600 seconds (an hour) if at least 1 change was performed # * After 300 seconds (5 minutes) if at least 100 changes were performed # * After 60 seconds if at least 10000 changes were performed # # You can set these explicitly by uncommenting the following line.</div>
	<div class="entry__meta meta mt tar">
	<time class="entry__meta-published meta-published" datetime="2022-12-03T17:02:57&#43;08:00">2022年12月03日</time>
	</div>
</article>
				</div>
			
				<div class="card card--1col">
					<article class="entry card__box block">
	<h1 class="entry__title title-excerpt"><a class="entry__title-link" href="/db/acid/">简述数据库中的 ACID 分别是什么？</a></h1>
	<div class="entry__content">ACID
 原子性  定义：每个事务都是不可分割的最小工作单元，事务中的所有操作要么全成功，要么全失败。使用undo log实现回滚。   一致性  定义：比如A向B转账，A减少1000，B就得增加1000，两人的余额总和不能变。   隔离性  定义：各个事务之间相互隔离，互不干扰。通过锁和MVCC实现隔离   持久性  定义：事务一旦提交，数据会永久的存储在数据库中。使用redo log实现故障恢复。      实现原理
  redo log
  定义： 包含redo log buffer（内存）和redo log file（磁盘），记录事务执行过程中数据修改后物理数据页面的信息。后台线程会将buffer中的数据同步到磁盘。
  流程图
  作用
 当mysql宕机时，如果buffer中还有数据没有同步到磁盘，可通过redo log 进行恢复（所以叫重做日志）。 确保事务的持久性    什么时候开始写redolog？什么时候释放redolog？
 当事务开始时就会写redolog 当buffer中的数据页同步到磁盘后，redolog就会被释放重用。    既然写redolog也有磁盘IO消耗，为什么不直接将数据写入磁盘呢？
 直接写磁盘是随机IO，写redolog是顺序IO，顺序IO比随机IO性能好。 因为mysql加载数据到内存，最小单位是页，所以即使有很小的改动，也会将整页更新，造成大量无效IO。而redolog只包含真正要写入的部分      undo log</div>
	<div class="entry__meta meta mt tar">
	<time class="entry__meta-published meta-published" datetime="2022-11-24T19:43:23&#43;08:00">2022年11月24日</time>
	</div>
</article>
				</div>
			
				<div class="card card--1col">
					<article class="entry card__box block">
	<h1 class="entry__title title-excerpt"><a class="entry__title-link" href="/db/%E8%81%9A%E7%B0%87%E7%B4%A2%E5%BC%95/">聚簇索引和非聚簇索引有什么区别？什么情况用聚集索引？</a></h1>
	<div class="entry__content">MyISAM索引实现
  使用B+树
  叶子节点的data域存储数据记录的地址（非聚簇索引）
  主键索引与普通索引结构一样
  查询数据时，首先找到data域中的地址，然后再根据地址去磁盘中读数据
  图示
    InnoDB的索引实现
  使用B+树
  主键索引叶子节点data域保存着完整的数据记录（聚簇索引）
  普通索引叶子节点data域保存着主键值（非聚簇索引）
  每个表只能有一个聚簇索引
  主键索引查询数据，只需根据主键值拿到叶子节点中data域的数据即可。而对于普通索引查询数据时，首先找到叶子节点data域中的主键值，然后再去主键索引中根据主键值去查数据。
  图示
  主键索引
  辅助索引
    聚簇索引与非聚簇索引定义
叶子节点data域保存完整数据记录的就是聚簇索引，叶子节点data域只保存主键值或数据地址的就是非聚簇索引
  什么是回表
通过辅助索引查询到主键值后，再拿主键值去主键索引中查找数据的过程就叫做回表
  什么是索引覆盖
 当sql语句中的select列（查询的字段）和where列（条件字段）都在一个索引中，则不需要进行回表，这就是索引覆盖。 例如：select id, name from users where name = &lsquo;jack&rsquo;; (对name建立辅助索引)。这个示例中由于对name字段建立辅助索引，而辅助索引每个叶子节点的data域保存主键值，则不需要进行回表操作，即可拿到id和name。 所有不需要回表的查询操作都是索引覆盖。 可利用索引覆盖来减少IO操作，从而提高查询效率。比如select id, name,age from users where name = &lsquo;jack&rsquo;; 可对name和age建立联合索引，从而避免回表。    什么是索引下推</div>
	<div class="entry__meta meta mt tar">
	<time class="entry__meta-published meta-published" datetime="2022-11-24T19:42:15&#43;08:00">2022年11月24日</time>
	</div>
</article>
				</div>
			
				<div class="card card--1col">
					<article class="entry card__box block">
	<h1 class="entry__title title-excerpt"><a class="entry__title-link" href="/db/%E4%B8%BA%E4%BB%80%E4%B9%88%E4%BD%BF%E7%94%A8b&#43;%E6%A0%91%E4%BD%9C%E4%B8%BA%E7%B4%A2%E5%BC%95%E7%9A%84%E5%BA%95%E5%B1%82%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/">MySQL 为什么使用 B&#43; 树来作索引，对比 B 树它的优点和缺点是什么？</a></h1>
	<div class="entry__content">B树（平衡多路搜索树）
  图示
  特征
 每个节点可有多棵子树 每个非叶子节点有n个key，并有n+1棵子树（子树数量比key数量多1） 每个节点中key都是从小到大排序的 最左子树上的值都小于最左key的值，最右子树上的值都小于最右key的值，中间子树的值则位于相邻两个节点的值之间 所有叶子节点都具有相同的深度    查询伪代码
BTree_Search(node, key) { if(node == null) return null; foreach(node.key) { if(node.key[i] == key) return node.data[i]; if(node.key[i] &gt; key) return BTree_Search(point[i]-&gt;node); } return BTree_Search(point[i+1]-&gt;node); } data = BTree_Search(root, my_key);   时间复杂度
O(log n)
    B+树
  图示
  特征
 子树与key的数量相同，节点的关键字为子树中的最大值 非叶子节点不保存数据，仅用作索引，叶子节点保存全部数据 所有叶子节点构成一个链表    时间复杂度</div>
	<div class="entry__meta meta mt tar">
	<time class="entry__meta-published meta-published" datetime="2022-11-24T19:34:15&#43;08:00">2022年11月24日</time>
	</div>
</article>
				</div>
			
				<div class="card card--1col">
					<article class="entry card__box block">
	<h1 class="entry__title title-excerpt"><a class="entry__title-link" href="/db/%E5%A4%96%E9%94%AE/">为什么数据库生产环境最好不要使用外键</a></h1>
	<div class="entry__content">常用的外键类型：
  RESTRICT：会触发一致性检查
例如： cities表中字段有id、name两个字段
​	buildings表有id、name、city_id三个字段。
​ 这时city_id就是关联到cities表的RESTRICT外键。
​	当向buildings表中新插入一条记录（88, &ldquo;故宫&rdquo;, 9）时，就需要去cities表中检测是否有id=9的城市，如果没有则会报错。
​ 当修噶buildings表中city_id的值时，需要检查cities表中是否存在这个id，如果没有则会报错。
​	当删除cities表中的id=7的城市时，需要检测buildings表中是否有引用city_id=7的记录，如果有则会报错。
  CASCADE：会触发级联操作
例如：
​	cities表中字段有id、name两个字段
​	buildings表有id、name、city_id三个字段。
​ 这时city_id就是关联到cities表的CASCADE外键。
​	当删除cities表中的id=7的城市，那么会去检查buildings表中是否有引用city_id=7的记录，如果有则会将他们也删除。
​	当修改cities表中的id=8的城市，将它的id修改为11时，buildings表中引用city_id=8的记录，也会被修改为11
  总结
  使用外键：
 可通过数据库外键特性保证数据一致性，但是可能会给数据库增加负载。    不使用外键：
 对于高并发的系统，使用外键会给数据库带来巨大的压力，所以生产环境一般不会使用外键 一致性检查、级联操作，由代码实现，会牺牲掉一部分一致性，但是可以给数据库减负    </div>
	<div class="entry__meta meta mt tar">
	<time class="entry__meta-published meta-published" datetime="2022-11-24T19:32:59&#43;08:00">2022年11月24日</time>
	</div>
</article>
				</div>
			
				<div class="card card--1col">
					<article class="entry card__box block">
	<h1 class="entry__title title-excerpt"><a class="entry__title-link" href="/db/%E5%A6%82%E4%BD%95%E5%88%9B%E5%BB%BA%E7%B4%A2%E5%BC%95/">如何创建索引</a></h1>
	<div class="entry__content">  (a,b)联合索引会触发filesort
  (a,b,c)联合索引会触发filesort
  (a,c,b)联合索引无filesort，但b无法使用索引（如果target_id用上索引，rows应为51，由于sql执行顺序）
  所以结论是：建立(a,c)联合索引为最优解
  </div>
	<div class="entry__meta meta mt tar">
	<time class="entry__meta-published meta-published" datetime="2021-11-24T19:34:55&#43;08:00">2021年11月24日</time>
	</div>
</article>
				</div>
			
				<div class="card card--1col">
					<article class="entry card__box block">
	<h1 class="entry__title title-excerpt"><a class="entry__title-link" href="/db/%E4%BA%8B%E5%8A%A1%E9%9A%94%E7%A6%BB%E7%BA%A7%E5%88%AB/">数据库的事务隔离级别有哪些？各有哪些优缺点？</a></h1>
	<div class="entry__content">事务隔离级别主要有四种
 读未提交 (READ UNCOMMITED)  定义：一个事务可以读取另一个事务已修改但未提交的数据 存在的问题  脏读 不可重复读 幻读     读已提交 (READ COMMITED)  定义：一个事务只能读取另一个事务已经提交的数据 存在的问题  不可重复读 幻读     可重复读 (REPEATABLE READ)（Mysql 默认隔离级别）  定义：在一个事务中多次读取同一条记录，结果一致，无论其他事务是否对这条记录做了修改 存在的问题  幻读     串行 (SERIALIZABLE)  定义：所有事务顺序执行 不存在脏读、不可重复读、幻读等问题      释义
 脏读  定义： 一个事务读到另一个事务已修改未提交的数据，如果前一个事务回滚，这个数据是错误的。或者在前一个事务修改之前读到了数据   不可重复读  定义：一个事务修改某一条数据，另一个事务在前一个事务提交之前读到的是修改前的数据，等前一个事务提交之后，读到的又是修改后的数据，造成两次读取同一条数据不一致   幻读  定义：某个表初始有三条数据，在一个事务中插入一条数据，另一个事务读到的也是三条数据，但是在前一个事务提交后，读到的应是4条。      优缺点</div>
	<div class="entry__meta meta mt tar">
	<time class="entry__meta-published meta-published" datetime="2020-11-24T19:41:37&#43;08:00">2020年11月24日</time>
	</div>
</article>
				</div>
			
		</div>
	</main>
	

	</div>
	<footer class="footer">
<div class="footer__social social">
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="mailto:zhanghaiyu@hellogroup.com">
			<svg class="social__icon" aria-label="Email" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M299 268l124 106c-4 4-10 7-17 7H106c-7 0-13-3-17-7l124-106 43 38 43-38zm-43 13L89 138c4-4 10-7 17-7h300c7 0 13 3 17 7L256 281zm54-23l121-105v208L310 258zM81 153l121 105L81 361V153z"/></svg>
		</a>
		<a class="social__link" target="_blank" rel="noopener noreferrer" href="https://github.com/fishwin">
			<svg class="social__icon" aria-label="Github" role="img" width="32" height="32" viewBox="0 0 512 512"><path d="M335 499c14 0 12 17 12 17H165s-2-17 12-17c13 0 16-6 16-12l-1-50c-71 16-86-28-86-28-12-30-28-37-28-37-24-16 1-16 1-16 26 2 40 26 40 26 22 39 59 28 74 22 2-17 9-28 16-35-57-6-116-28-116-126 0-28 10-51 26-69-3-6-11-32 3-67 0 0 21-7 70 26 42-12 86-12 128 0 49-33 70-26 70-26 14 35 6 61 3 67 16 18 26 41 26 69 0 98-60 120-117 126 10 8 18 24 18 48l-1 70c0 6 3 12 16 12z"/></svg>
		</a>
</div>
	<div class="footer__copyright">© 2022 张海余的主页. <span class="footer__copyright-credits">Powered by <a href="https://gohugo.io/" rel="nofollow noopener" target="_blank">Hugo</a> and <a href="https://github.com/vimux/binario" rel="nofollow noopener" target="_blank">Binario</a> theme.</span></div>
</footer>
<script src="/js/menu.js"></script>
<script src="/js/custom.js"></script>
</body>
</html>